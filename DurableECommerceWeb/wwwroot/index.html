<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Durable Functions Shop</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>

    <div class="text-center bg-light mb-0">
        <h1>Durable Functions Demo Shop</h1>
        <p>Buy a training course!</p>
    </div>
    <div id="app" class="container">
        <div class="row">
            <div class="col-md-4" v-for="product in products" :key="product.id">
                <div class="card">
                    <img class="card-img-top" :src="product.image" :alt="product.name">
                    <div class="card-body">
                        <h4 class="card-title">{{product.name}}</h4>
                        <p class="card-text">Some example text.</p>
                        <a href="#" @click="buy(product)"
                           class="btn btn-primary purchase">Buy now for ${{product.price}}</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" v-if="orderId">
            <div class="alert alert-success">
                <strong>Great choice!</strong>
                Thank you for purchasing <strong>{{orderedProduct.name}}</strong>. Your order number is <strong><a :href="'orderStatus/' + orderId">{{orderId}}</a></strong>
            </div>
        </div>
    </div>

    <script>
        const postData = (url = '', data = {}) => {
            // Default options are marked with *
            return fetch(url,
                    {
                        method: "POST", // *GET, POST, PUT, DELETE, etc.
                        mode: "no-cors", // no-cors, cors, *same-origin
                        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                        credentials: "same-origin", // include, same-origin, *omit
                        headers: {
                            "Content-Type": "application/json; charset=utf-8"
                        },
                        redirect: "follow", // manual, *follow, error
                        referrer: "no-referrer", // no-referrer, *client
                        body: JSON.stringify(data) // body data type must match "Content-Type" header
                    })
                .then(response => response.json()); // parses response to JSON
        };

        var app = new Vue({
            el: '#app',
            data: {
                products: [
                    { id: 'performance-tuning', name: 'Performance Tuning', price: 2000, image: 'images/strat.jpg' },
                    {
                        id: 'achieving-your-goals',
                        name: 'Achieving Your Goals',
                        price: 400,
                        image: 'images/football.jpg'
                    },
                    {
                        id: 'cake-driven-development',
                        name: 'Cake Driven Development',
                        price: 50,
                        image: 'images/cakes.jpg'
                    }
                ],
                orderId: null,
                orderedProduct: ""
            },
            methods: {
                onOrderCreated: function(orderInfo) {
                    this.orderId = orderInfo.id;
                },
                buy: function(product) {
                    this.orderedProduct = product;
                    console.log(`purchased a ${product.id} for ${product.price}`);
                    postData('/api/CreateOrder', { ProductId: product.id, Amount: product.price })
                        .then(data => this.onOrderCreated(data))
                        .catch(error => console.dir(error));
                }
            }
        });
    </script>
</body>
</html>